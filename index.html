<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temporizador TerrorÃ­fico</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { height:100%; overflow:hidden; font-family:'Cinzel', serif; background:black; }
  body { position:relative; }

  .bg {
    position:absolute; width:100%; height:100%;
    background-size:cover; background-position:center; background-repeat:no-repeat;
    opacity:0; transition: opacity 3s ease-in-out;
  }
  .bg.active { opacity:1; }

  #timer {
    position:absolute; top:100px; left:50%; transform:translateX(-50%);
    text-align:center; font-size:3em; font-weight:bold; color:red;
    text-shadow: 
        0 0 5px red,
        0 0 10px red,
        2px 2px 10px black,
        0 0 20px red,
        0 0 30px black;
    padding:10px 30px; border-radius:10px;
    z-index:10; background-color:transparent;
  }

  #musicToggle {
    position:absolute; top:20px; right:20px;
    font-size:2em; color:red; cursor:pointer; z-index:20;
    text-shadow:2px 2px 10px black; user-select:none; opacity:1; transition:opacity 0.5s ease;
  }

  #overlay {
    position:absolute; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); display:flex; flex-direction:column;
    justify-content:center; align-items:center; z-index:30;
  }
  #overlay input {
    font-size:2em; padding:10px 20px; text-align:center;
    margin-bottom:20px; background-color:black; color:red;
    border:2px solid red; border-radius:10px;
  }
  #overlay button {
    font-size:1.5em; padding:10px 20px; cursor:pointer;
    background-color:red; color:black; border:none; border-radius:10px;
    transition: transform 0.2s;
  }
  #overlay button:hover { transform:scale(1.1); }
  #overlay button:disabled { opacity:0.5; cursor:not-allowed; }
</style>
</head>
<body>

<div id="bg1" class="bg active"></div>
<div id="bg2" class="bg"></div>

<div id="timer">00:00:00</div>
<div id="musicToggle" title="Activar / Desactivar mÃºsica">ðŸ”Š</div>

<div id="overlay">
  <input type="text" id="timeInput" placeholder="hh:mm:ss" maxlength="8">
  <button id="startBtn" disabled>Iniciar Temporizador</button>
</div>

<audio id="bgMusic" src="SCP-x3x.mp3"></audio>
<audio id="bellSound" src="campana.mp3"></audio>

<script>
  // --- Lista explÃ­cita de imÃ¡genes para GitHub Pages ---
  const images = [
    "imagenes/2150812582.jpg",
    "imagenes/2150812638.jpg",
    "imagenes/2150838758.jpg"
  ];

  let currentImage = 0, currentLayer = 1;
  const bg1 = document.getElementById('bg1');
  const bg2 = document.getElementById('bg2');
  let bgInterval;

  // Inicializamos los dos primeros fondos
  if(images.length>0) bg1.style.backgroundImage = `url('${images[0]}')`;
  if(images.length>1) bg2.style.backgroundImage = `url('${images[1]}')`;

  function getNextImage(){
    if(images.length<=1) return images[0];
    const options = images.filter(img => img !== images[currentImage]);
    const idx = Math.floor(Math.random()*options.length);
    const nextImage = options[idx];
    currentImage = images.indexOf(nextImage);
    return nextImage;
  }

  function startBackgroundLoop(){
    bgInterval = setInterval(()=>{
      const nextImg = getNextImage();
      const activeLayer = currentLayer===1 ? bg1 : bg2;
      const nextLayer = currentLayer===1 ? bg2 : bg1;
      nextLayer.style.backgroundImage = `url('${nextImg}')`;
      nextLayer.classList.add('active');
      activeLayer.classList.remove('active');
      currentLayer = currentLayer===1 ? 2 : 1;
    },20000);
  }

  // --- Temporizador ---
  const timerDisplay = document.getElementById('timer');
  const timeInput = document.getElementById('timeInput');
  const startBtn = document.getElementById('startBtn');
  const overlay = document.getElementById('overlay');
  const bellSound = document.getElementById('bellSound');
  let totalSeconds=0;
  let timerInterval;

  const bgMusic = document.getElementById('bgMusic');
  const musicToggle = document.getElementById('musicToggle');
  let musicOn=false;

  function formatToHHMMSS(sec){
    const h=Math.floor(sec/3600);
    const m=Math.floor((sec%3600)/60);
    const s=sec%60;
    return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  }

  function parseHHMMSS(str){
    const parts = str.split(':');
    if(parts.length !== 3) return null;
    const h=parseInt(parts[0],10);
    const m=parseInt(parts[1],10);
    const s=parseInt(parts[2],10);
    if(isNaN(h)||isNaN(m)||isNaN(s)) return null;
    if(h<0||m<0||m>59||s<0||s>59) return null;
    return h*3600 + m*60 + s;
  }

  // ValidaciÃ³n y formateo en tiempo real
  timeInput.addEventListener('input',()=>{
    let val = timeInput.value.replace(/[^0-9]/g,'');
    if(val.length>6) val=val.slice(0,6);

    let formatted='';
    if(val.length<=2) formatted=val;
    else if(val.length<=4) formatted=val.slice(0,2)+':'+val.slice(2);
    else formatted=val.slice(0,2)+':'+val.slice(2,4)+':'+val.slice(4);

    timeInput.value = formatted;
    const parsed = parseHHMMSS(formatted);
    startBtn.disabled = (parsed===null);
  });

  function updateTimer(){
    const hours = Math.floor(totalSeconds/3600);
    const minutes = Math.floor((totalSeconds%3600)/60);
    const seconds = totalSeconds%60;
    timerDisplay.textContent = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;

    if(totalSeconds <=0){
      clearInterval(timerInterval);
      bgMusic.pause();
      bgMusic.currentTime=0;
      bellSound.play();
    }
    totalSeconds--;
  }

  startBtn.addEventListener('click',()=>{
    const parsed=parseHHMMSS(timeInput.value);
    if(parsed===null || parsed<=0){
      alert("Formato incorrecto. hh:mm:ss");
      return;
    }
    totalSeconds=parsed;
    timeInput.value = formatToHHMMSS(totalSeconds);
    overlay.style.display='none';
    updateTimer();
    clearInterval(timerInterval);
    timerInterval=setInterval(updateTimer,1000);

    if(!musicOn){
      bgMusic.volume=0.3;
      bgMusic.play();
      musicOn=true;
      musicToggle.textContent='ðŸ”Š';
    }

    if(!bgInterval){
      startBackgroundLoop();
    }
  });

  // --- MÃºsica ---
  musicToggle.addEventListener('click',()=>{
    if(!musicOn){
      bgMusic.volume=0.3;
      bgMusic.play();
      musicToggle.textContent='ðŸ”Š';
      musicOn=true;
    } else{
      bgMusic.pause();
      musicToggle.textContent='ðŸ”‡';
      musicOn=false;
    }
  });

  bgMusic.addEventListener('ended',()=>{ if(musicOn) bgMusic.play(); });

  // --- Ocultar icono tras 5s ---
  let hideTimeout;
  function resetHideTimer(){
    musicToggle.style.opacity=1;
    clearTimeout(hideTimeout);
    hideTimeout=setTimeout(()=>{ musicToggle.style.opacity=0; },5000);
  }
  window.addEventListener('mousemove',resetHideTimer);
  window.addEventListener('touchstart',resetHideTimer);
  resetHideTimer();
</script>

</body>
</html>
